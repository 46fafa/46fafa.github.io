{{ define "body-class" }}media-page{{ end }}
{{ define "main" }}
        <!-- <header>
            <div class="article-title-wrapper">
            <h2 class="article-title">{{ .Title }}</h2>
            </div>
        </header> -->
    <div class="article-content">
        {{ .Content }}
    </div>
    {{ $moviesData := sort .Site.Data.movies "year" "desc" }}
    {{ $tvData := sort .Site.Data.tvs "year" "desc" }}
    {{ $booksData := sort .Site.Data.books "year" "desc" }}

        {{/* 2. 定义当前年份变量（yyyy格式） */}}
    {{ $currentYear := now.Format "2006" }} {{/* 2006是Hugo固定的年份参考值，用于格式化 */}}

    {{/* 3. 统计当前年份的电影总数 */}}
    {{ $totalMovies := 0 }}
    {{ range $moviesData }}
        {{ $itemYear := substr .year 0 4 }} {{/* 从"YYYY-MM"中截取前4位作为年份 */}}
        {{ if eq $itemYear $currentYear }} {{/* 仅统计当前年份的内容 */}}
            {{ $totalMovies = add $totalMovies 1 }} {{/* 计数+1 */}}
        {{ end }}
    {{ end }}

    {{/* 4. 统计当前年份的剧集总数 */}}
    {{ $totalTvs := 0 }}
    {{ range $tvData }}
        {{ $itemYear := substr .year 0 4 }}
        {{ if eq $itemYear $currentYear }}
            {{ $totalTvs = add $totalTvs 1 }}
        {{ end }}
    {{ end }}

    {{/* 5. 统计当前年份的书籍总数 */}}
    {{ $totalBooks := 0 }}
    {{ range $booksData }}
        {{ $itemYear := substr .year 0 4 }}
        {{ if eq $itemYear $currentYear }}
            {{ $totalBooks = add $totalBooks 1 }}
        {{ end }}
    {{ end }}
<p class="yearly-stats">{{ $currentYear }}年看了<span>{{ $totalBooks }}</span>本书,<span>{{ $totalMovies }}</span>部电影,<span>{{ $totalTvs }}</span>部电视剧.</p>
    {{ $firstActiveType := "movies" }} 
    <div class="type-buttons">
        <button class="type-btn{{ if eq $firstActiveType "movies" }} active{{ end }}" data-type="movies">电影</button>
        <button class="type-btn{{ if eq $firstActiveType "tvs" }} active{{ end }}" data-type="tvs">剧集</button>
        <button class="type-btn{{ if eq $firstActiveType "books" }} active{{ end }}" data-type="books">书籍</button>
    </div>

    {{ if $moviesData }}
        <div class="media-grid{{ if eq $firstActiveType "movies" }} active{{ end }}" data-type="movies">
            {{ $currentYearMovie := "" }} 
            {{ range $moviesData }}
                {{ if ne .year $currentYearMovie }}
                    {{ if ne $currentYearMovie "" }}
                        </div> 
                        </div> 
                    {{ end }}
                    
                    <div class="year-group">
                        <div class="year-date-column">
                            <span class="year-display-month">{{ substr .year 5 2 }}</span>
                            <span class="year-display-year">{{ substr .year 0 4 }}</span>
                        </div>
                        <div class="year-items">
                    {{ $currentYearMovie = .year }}
                {{ end }}
                <div class="media-card">
                    <div class="media-poster">
                        {{ if .cover }}
                            <img src="{{ .cover }}" alt="{{ .title }}" loading="lazy">
                        {{ else }}
                            <div class="no-poster">No Cover Available</div>
                        {{ end }}
                    </div>
                    <div class="media-info">
                        <h3 class="media-title">{{ .title }} </span></h3>
                        <div class="media-meta">
                            {{ if .rating }}
                                <span class="rating">评分⭐ {{ printf "%.1f" .rating }}</span>
                            {{ end }}
                        </div>
                    </div>
                </div>
            {{ end }}
            {{ if ne $currentYearMovie "" }}
                </div> 
                </div> 
            {{ end }}
        </div>
    {{ end }}

    {{ if $tvData }}
        <div class="media-grid{{ if eq $firstActiveType "tvs" }} active{{ end }}" data-type="tvs">
            {{ $currentYearTv := "" }} 
            {{ range $tvData }}
                {{ if ne .year $currentYearTv }}
                    {{ if ne $currentYearTv "" }}
                        </div> 
                        </div> 
                    {{ end }}
              
                    <div class="year-group">
                        <div class="year-date-column">
                            <span class="year-display-month">{{ substr .year 5 2 }}</span>
                            <span class="year-display-year">{{ substr .year 0 4 }}</span>
                        </div>
                        <div class="year-items">
                    {{ $currentYearTv = .year }}
                {{ end }}
                <div class="media-card">
                    <div class="media-poster">
                        {{ if .cover }}
                            <img src="{{ .cover }}" alt="{{ .title }}" loading="lazy">
                        {{ else }}
                            <div class="no-poster">No Cover Available</div>
                        {{ end }}
                    </div>
                    <div class="media-info">
                        <h3 class="media-title">{{ .title }} </span></h3>
                        <div class="media-meta">
                            {{ if .rating }}
                                <span class="rating">⭐ {{ printf "%.1f" .rating }}</span>
                            {{ end }}
                        </div>
                    </div>
                </div>
            {{ end }}
            {{ if ne $currentYearTv "" }}
                </div> 
                </div> 
            {{ end }}
        </div>
    {{ end }}

    {{ if $booksData }}
        <div class="media-grid{{ if eq $firstActiveType "books" }} active{{ end }}" data-type="books">
            {{ $currentYearBook := "" }} 
            {{ range $booksData }}
                {{ if ne .year $currentYearBook }}
                    {{ if ne $currentYearBook "" }}
                        </div> 
                        </div> 
                    {{ end }}
                   
                    <div class="year-group">
                        <div class="year-date-column">
                            <span class="year-display-month">{{ substr .year 5 2 }}</span>
                            <span class="year-display-year">{{ substr .year 0 4 }}</span>
                        </div>
                        <div class="year-items">
                    {{ $currentYearBook = .year }}
                {{ end }}
                <div class="media-card">
                    <div class="media-poster">
                        {{ if .cover }}
                            <img src="{{ .cover }}" alt="{{ .title }}" loading="lazy">
                        {{ else }}
                            <div class="no-poster">No Cover Available</div>
                        {{ end }}
                    </div>
                    <div class="media-info">
                        <h3 class="media-title">{{ .title }} </span></h3>
                        <div class="media-meta">
                            {{ if .rating }}
                                <span class="rating">⭐ {{ printf "%.1f" .rating }}</span>
                            {{ end }}
                        </div>
                    </div>
                </div>
            {{ end }}
            {{ if ne $currentYearBook "" }}
                </div>
                </div>
            {{ end }}
        </div>
    {{ end }}

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const typeButtons = document.querySelectorAll('.type-btn');
            const grids = document.querySelectorAll('.media-grid');
            function showType(type) {
                typeButtons.forEach(btn => btn.classList.remove('active'));
                grids.forEach(grid => grid.classList.remove('active'));
                const activeBtn = document.querySelector(`.type-btn[data-type="${type}"]`);
                const activeGrid = document.querySelector(`.media-grid[data-type="${type}"]`);


                if (activeBtn) activeBtn.classList.add('active');
                if (activeGrid) activeGrid.classList.add('active');
            }
            const initialType = '{{ $firstActiveType }}';
            showType(initialType);

            typeButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const type = this.dataset.type;
                    showType(type);
                });
            });
        });
    </script>
{{ end }}